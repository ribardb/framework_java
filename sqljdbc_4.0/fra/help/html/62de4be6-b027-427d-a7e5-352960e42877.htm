<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Pilote JDBC pour la prise en charge de la haute disponibilité et de la récupération d'urgence</title><meta name="Language" content="fr-fr" /><meta name="Microsoft.Help.Id" content="62de4be6-b027-427d-a7e5-352960e42877" /><meta name="Description" content="Cette rubrique traite de la prise en charge de Pilote JDBC Microsoft pour SQL Server en ce qui concerne la haute disponibilité et la récupération d'urgence -- Groupes de disponibilité AlwaysOn." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Pilote JDBC pour la prise en charge de la haute disponibilité et de la récupération d'urgence</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>Cette rubrique traite de la prise en charge de Pilote JDBC Microsoft pour SQL Server en ce qui concerne la haute disponibilité et la récupération d'urgence -- Groupes de disponibilité AlwaysOn. Pour plus d'informations sur les Groupes de disponibilité AlwaysOn, consultez la documentation en ligne de SQL Server 2012.</p><p>À partir de la version 4.0 du Pilote JDBC Microsoft pour SQL Server, il est possible de spécifier l'écouteur du groupe de disponibilité (haute disponibilité et récupération d'urgence) depuis la propriété de connexion. Si une application Pilote JDBC Microsoft pour SQL Server est connectée à une base de données AlwaysOn sur laquelle un basculement est effectué, la connexion d'origine sera interrompue. L'application devra alors établir une nouvelle connexion pour poursuivre la tâche après le basculement.</p><p>Si vous ne vous connectez pas à un écouteur de groupe de disponibilité, et si plusieurs adresses IP sont associées au serveur, le Pilote JDBC Microsoft pour SQL Server tentera de se connecter à la première adresse IP. Si le Pilote JDBC Microsoft pour SQL Server ne parvient pas à établir de connexion avec la première adresse IP, la connexion échouera. Le Pilote JDBC Microsoft pour SQL Server ne tentera pas de se connecter à l'adresse IP suivante qui est associée au serveur. Lors de la connexion à un écouteur de groupe de disponibilité, le Pilote JDBC Microsoft pour SQL Server tente d'établir une connexion avec toutes les adresses IP en parallèle. Lorsqu'une tentative de connexion réussit, le pilote supprime toutes les tentatives de connexion en attente.</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>Le rallongement du délai de connexion et l'implémentation d'une logique de déclenchement de nouvelles tentatives de connexion permettent d'augmenter la probabilité de connexion entre une application et un groupe de disponibilité. En raison du risque d'échec de connexion en cas de basculement d'un groupe de disponibilité, il est également nécessaire d'implémenter la logique de déclenchement de nouvelles tentatives de connexion, afin de multiplier les tentatives jusqu'à ce qu'une connexion soit établie.</p></div><p>Les <a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">propriétés de connexion</a> suivantes ont été ajoutées au Pilote JDBC 4.0 Microsoft pour SQL Server :</p><ul><li><p><span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span></p></li><li><p><span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span></p></li></ul></div><h1 class="heading">Connexion à MultiSubnetFailover</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Spécifiez toujours <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> lorsque vous vous connectez à l'écouteur d'un groupe de disponibilité SQL Server 2012 ou d'une instance de cluster de basculement SQL Server 2012. <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> permet un basculement plus rapide de tous les groupes de disponibilité et instances de cluster de basculement dans SQL Server 2012. Par ailleurs, il permet de réduire le temps de basculement des topologies AlwaysOn de sous-réseaux uniques et multiples. Lors d'un basculement de sous-réseaux multiples, le client tentera d'établir des connexions en parallèle. Lors d'un basculement de sous-réseau unique, le Pilote JDBC Microsoft pour SQL Server tentera intensément d'établir la connexion au TCP.</p><p>La propriété de connexion <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> indique que l'application est en cours de déploiement dans un groupe de disponibilité ou une instance de cluster de basculement. Elle indique également que le Pilote JDBC Microsoft pour SQL Server essaiera de se connecter à la base de données d'une instance principale SQL Server en tentant de se connecter à toutes les adresses IP. Lorsque <span sdata="langKeyword" value="MultiSubnetFailover=true"><span class="keyword">MultiSubnetFailover=true</span></span> est spécifié dans le cadre d'une connexion, le client retente d'établir une connexion TCP plus rapidement que les intervalles de retransmission TCP par défaut du système d'exploitation. Cela permet une reconnexion plus rapide des groupes de disponibilité AlwaysOn et des instances de cluster de basculement AlwaysOn après le basculement, et ce, à la fois pour les groupes de disponibilité et les instances de cluster de basculement de sous-réseaux uniques et multiples.</p><p>Pour plus d'informations sur les mots clés de chaîne de connexion dans le Pilote JDBC Microsoft pour SQL Server, consultez <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Définition des propriétés de connexion</a></span>.</p><p>La spécification de <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> lors de la connexion à un élément autre qu'un écouteur de groupe de disponibilité ou d'instance de cluster de basculement peut affecter les performances et ne pas être prise en charge.</p><p>Si le gestionnaire de sécurité n'est pas installé, la machine virtuelle Java met en cache les adresses IP virtuelles pour une durée définie par défaut par votre implémentation JDK et les propriétés Java networkaddress.cache.ttl et networkaddress.cache.negative.ttl. Si le gestionnaire de sécurité JDK est installé, la machine virtuelle Java mettra en cache les adresses IP virtuelles et n'actualisera pas le cache par défaut. Vous devez définir la durée de vie (TTL, time-to-live – networkaddress.cache.ttl) sur un jour pour le cache de la machine virtuelle Java. Si vous ne modifiez pas la valeur par défaut en attribuant une valeur égale à un jour (environ), l'ancienne valeur ne sera pas supprimée définitivement du cache de la machine virtuelle Java lorsqu'une adresse IP virtuelle sera ajoutée ou mise à jour. Pour en savoir plus sur networkaddress.cache.ttl et networkaddress.cache.negative.ttl, consultez <a href="http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html">http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html</a>.</p><p>Utilisez les consignes suivantes pour vous connecter à un serveur situé dans un groupe de disponibilité ou une instance de cluster de basculement :</p><ul><li><p>Le pilote génèrera une erreur si la propriété de connexion <span sdata="langKeyword" value="instanceName"><span class="keyword">instanceName</span></span> est utilisée dans la même chaîne de connexion que la propriété de connexion <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span>. Cela révèle que SQL Browser n'est pas utilisé dans un groupe de disponibilité. Toutefois, si la propriété de connexion <span sdata="langKeyword" value="portNumber"><span class="keyword">portNumber</span></span> est également spécifiée, le pilote ignorera <span sdata="langKeyword" value="instanceName"><span class="keyword">instanceName</span></span> et utilisera <span sdata="langKeyword" value="portNumber"><span class="keyword">portNumber</span></span> à la place.</p></li><li><p>Utilisez la propriété de connexion <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> lorsque vous vous connectez à un sous-réseau unique ou à des sous-réseaux multiples afin d'améliorer leurs performances.</p></li><li><p>Pour vous connecter à un groupe de disponibilité, spécifiez l'écouteur du groupe de disponibilité en tant que serveur dans votre chaîne de connexion. Par exemple, jdbc:sqlserver://VNN1.</p></li><li><p>La connexion à une instance SQL Server configurée à l'aide de plus de 64 adresses IP entraînera l'échec de la connexion.</p></li><li><p>Le comportement d'une application qui utilise la propriété de connexion <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> peut ne pas être affecté, en fonction du type d'authentification : authentification SQL Server, Kerberos ou Windows.</p></li><li><p>Augmentez la valeur de la propriété <span sdata="langKeyword" value="loginTimeout"><span class="keyword">loginTimeout</span></span> pour permettre le basculement de serveur et réduire le nombre de tentatives de connexion d'une application.</p></li><li><p>Les transactions distribuées ne sont pas prises en charge.</p></li></ul><p>Si le routage en lecture seule n'est pas utilisé, la connexion à un emplacement de réplica secondaire au sein d'un groupe de disponibilité échouera dans les cas suivants :</p><ol><li><p>Si l'emplacement du réplica secondaire n'est pas configuré de manière à accepter les connexions.</p></li><li><p>Si une application utilise <span sdata="langKeyword" value="applicationIntent=ReadWrite"><span class="keyword">applicationIntent=ReadWrite</span></span> (abordé plus bas) et que l'emplacement du réplica secondaire est configuré pour un accès en lecture seule.</p></li></ol><p>La connexion échouera si un réplica principal est configuré de manière à refuser les charges de travail en lecture seule et si la chaîne de connexion contient le mot clé <span sdata="langKeyword" value="ApplicationIntent=ReadOnly"><span class="keyword">ApplicationIntent=ReadOnly</span></span>.</p></div><h1 class="heading">Mise à niveau vers des clusters de sous-réseaux multiples depuis une mise en miroir de bases de données</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>Si vous mettez à niveau une application Pilote JDBC Microsoft pour SQL Server qui utilise actuellement une mise en miroir de bases de données dans un scénario impliquant des sous-réseaux multiples, vous devrez supprimer la propriété de connexion <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> et la remplacer par <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> avec la valeur <span sdata="langKeyword" value="true"><span class="keyword">true</span></span>, et remplacer le nom du serveur par un écouteur de groupe de disponibilité dans la chaîne de connexion. Si la chaîne de connexion utilise <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> et <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span>, le pilote génèrera une erreur. Toutefois, si la chaîne de connexion utilise <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> et <span sdata="langKeyword" value="multiSubnetFailover=false"><span class="keyword">multiSubnetFailover=false</span></span> (ou <span sdata="langKeyword" value="ApplicationIntent=ReadWrite"><span class="keyword">ApplicationIntent=ReadWrite</span></span>), l'application utilisera la mise en miroir de bases de données.</p><p>Le pilote retournera une erreur si la mise en miroir de bases de données est utilisée pour la base de données principale au sein du groupe de disponibilité, et si <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> est utilisé dans la chaîne de connexion qui établit une connexion avec une base de données principale au lieu d'un écouteur de groupe de disponibilité.</p></div><h1 class="heading">Spécification de l'intention d'une application</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>Lorsque <span sdata="langKeyword" value="applicationIntent=ReadOnly"><span class="keyword">applicationIntent=ReadOnly</span></span>, le client émet une requête pour une charge de travail en lecture seule lors de la connexion à une base de données compatible AlwaysOn. Le serveur appliquera l'intention au moment de la connexion et durant une instruction de base de données USE, mais uniquement à une base de données compatible AlwaysOn.</p><p>Le mot clé <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> n'est pas compatible avec les bases de données héritées en lecture seule.</p><p>Une base de données peut autoriser ou interdire les charges de travail de lecture dans la base de données AlwaysOn ciblée (pour cela, utilisez la clause <span sdata="langKeyword" value="ALLOW_CONNECTIONS"><span class="keyword">ALLOW_CONNECTIONS</span></span> des instructions <span sdata="langKeyword" value="PRIMARY_ROLE"><span class="keyword">PRIMARY_ROLE</span></span> et <span sdata="langKeyword" value="SECONDARY_ROLE"><span class="keyword">SECONDARY_ROLE</span></span> Transact-SQL).</p><p>Le mot clé <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> sert à activer le routage en lecture seule.</p></div><h1 class="heading">Routage en lecture seule</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>Le routage en lecture seule est une fonctionnalité qui permet de garantir la disponibilité d'un réplica de base de données en lecture seule. Pour activer le routage en lecture seule :</p><ol><li><p>Connectez-vous à un écouteur de groupe de disponibilité AlwaysOn.</p></li><li><p>Le mot clé <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> de la chaîne de connexion doit avoir la valeur <span sdata="langKeyword" value="ReadOnly"><span class="keyword">ReadOnly</span></span>.</p></li><li><p> Le groupe de disponibilité doit être configuré par l'administrateur de la base de données de manière à activer le routage en lecture seule.</p></li></ol><p>Il est possible que plusieurs connexions utilisant le routage en lecture seule ne se connectent pas toutes au même réplica en lecture seule. Les modifications dues à la synchronisation des bases de données ou les modifications de configuration du routage du serveur peuvent faire que le client se connecte à plusieurs réplicas en lecture seule différents. Pour faire en sorte que toutes les requêtes en lecture seule se connectent au même réplica en lecture seule, ne transmettez pas d'écouteur de groupe de disponibilité ou d'adresse IP virtuelle au mot clé de chaîne de connexion <span sdata="langKeyword" value="serverName"><span class="keyword">serverName</span></span>. Spécifiez plutôt le nom de l'instance en lecture seule.</p><p>Le routage en lecture seule peut prendre plus longtemps que la connexion à la base de données principale, car il se connecte d'abord à la base de données principale, puis recherche la meilleure base de données secondaire accessible disponible. C'est pour cette raison qu'il est préférable de rallonger le délai de connexion.</p></div><h1 class="heading">Nouvelles méthodes prenant en charge multiSubnetFailover et applicationIntent</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>Les méthodes suivantes vous donnent un accès par programme aux mots clés de chaîne de connexion <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> et <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> :</p><ul><li><p><a href="19411e6c-c456-4533-8252-54569a2a6b1f.htm">SQLServerDataSource.getApplicationIntent</a></p></li><li><p><a href="e164c8ac-a0ae-4638-affb-ed454e7c0708.htm">SQLServerDataSource.setApplicationIntent</a></p></li><li><p><a href="1e8cb175-5f4c-4208-b4f5-3646990a30e3.htm">SQLServerDataSource.getMultiSubnetFailover</a></p></li><li><p><a href="7ffd282d-c2f6-4d1b-a7a6-859d18b388aa.htm">SQLServerDataSource.setMultiSubnetFailover</a></p></li><li><p><a href="b5eaad8a-31ef-44ac-af11-d5caa13ac3e2.htm">SQLServerDriver.getPropertyInfo</a></p></li></ul><p>Les méthodes <span sdata="langKeyword" value="getMultiSubnetFailover"><span class="keyword">getMultiSubnetFailover</span></span>, <span sdata="langKeyword" value="setMultiSubnetFailover"><span class="keyword">setMultiSubnetFailover</span></span>, <span sdata="langKeyword" value="getApplicationIntent"><span class="keyword">getApplicationIntent</span></span> et <span sdata="langKeyword" value="setApplicationIntent"><span class="keyword">setApplicationIntent</span></span> sont également ajoutées à l'<span sdata="link"><a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">Classe SQLServerDataSource</a></span>, à la <span sdata="link"><a href="b00e5a90-2af7-4d04-8ef8-256183777dcf.htm">Classe SQLServerConnectionPoolDataSource</a></span> et à la <span sdata="link"><a href="95fc7b07-2498-4a7e-8f7f-ee0d86b598b4.htm">Classe SQLServerXADataSource</a></span>.</p></div><h1 class="heading">Validation du certificat SSL</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>Un groupe de disponibilité correspond à un groupe de serveurs physiques. Le Pilote JDBC 4.0 Microsoft pour SQL Server prend désormais en charge le <span sdata="langKeyword" value="Subject Alternate Name"><span class="keyword">Subject Alternate Name</span></span> dans les certificats SSL de manière à permettre l'association de plusieurs hôtes et d'un même certificat. Pour plus d'informations sur SSL, consultez <span sdata="link"><a href="073f3b9e-8edd-4815-88ea-de0655d0325e.htm">Fonctionnement de la prise en charge SSL</a></span>.</p></div><span id="seeAlsoSpan"><h1 class="heading">Voir aussi</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Définition des propriétés de connexion</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Connexion à SQL Server à l'aide du pilote JDBC</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Envoyez vos <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dMerci pour vos commentaires qui permettent aux équipes chargées de rédiger la documentation développeur d\'en améliorer la qualité. Pendant la révision de vos commentaires, il est possible que nous vous contactions par courrier électronique afin de vous demander des éclaircissements ou d\'autres commentaires sur la solution envisagée. Nous n\'utilisons pas votre adresse de messagerie dans un autre but et nous la supprimons une fois notre révision terminée.%0\APour plus d\'informations sur les politiques de confidentialité de Microsoft, consultez http://privacy.microsoft.com/fr-fr/default.aspx.%0\A%0\d','Commentaires client.');">commentaires</a> sur cette rubrique à Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Tous droits réservés.</a></p></span></div></div></body></html>